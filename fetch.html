<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fetch</title>
  </head>
  <body>
    <div id="js-content">
    </div>
    <script type="text/javascript">
      function $(id) {
        return document.getElementById(id);
      }
      function addChild(parent, name, data, imgURL) {
        var element = document.createElement('h2');
        var nameNode = document.createTextNode(name);
        element.appendChild(nameNode);
        parent.appendChild(element);

        var oImg=document.createElement("img");
        oImg.setAttribute('src', imgURL);
        oImg.setAttribute('alt', 'avatar');
        oImg.setAttribute('height', '100px');
        oImg.setAttribute('width', '100px');
        parent.appendChild(oImg);

        var description = document.createElement('p');
        var desNode = document.createTextNode(data);
        description.appendChild(desNode);
        parent.appendChild(description);
      }
      window.onload = function() {
        const url = 'https://koombea-dummy-api.herokuapp.com/people/';
        if(window.fetch) {
          var myHeaders = new Headers();

          var myInit = { method: 'GET',
                         headers: myHeaders,
                         mode: 'cors',
                         cache: 'default' };

          fetch(url, myInit)
          .then(function(response) {
            if(response.ok) {
              response.json()
              .then(function(rObj) {
                let parent = $('js-content');
                rObj.people.forEach(function(e) {
                  console.log(e)
                  let name = `${e.first_name} ${e.last_name}`;
                  let additionalData = `Birth date: ${e.birthdate} - e-mail: ${e.email}`;
                  addChild(parent, name, additionalData, e.avatar_url);
                });
              });
            } else {
              $('js-content').innerHTML('Ha ocurrido un error.');
            }
          });
        }
      }
    </script>
  </body>
</html>
